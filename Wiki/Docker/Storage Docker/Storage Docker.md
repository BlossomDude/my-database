---
Owner: Blossom Dude
Last edited time: 2024-07-08T17:19
Created time: 2023-11-13T20:24
---
  

> [!important]  
> Файловая система на хосте:
> /var/lib/docker/ 
> - aufs 
> - containers 
> - image 
> - volumes    

> Образ докер имеет слоеную архитектуру, и изменить образ после сборки нельзя, только через запуск новой сборки. Только верхний слой является rw. Этот слой существует пока жив контейнер, если контейнер разрушается, слой уничтожается.


**Copy-On-Write**

Если во время работы контейнера я измени файл из нижнего слоя, по сути файл этот не изменится, я буду редактировать его копию перемещенную в верхний слой, **поэтому сохраняется целостность образа.**

  
### Volume Plugins

**Volume Plugins** в Docker — это расширения, которые позволяют Docker работать с внешними системами хранения данных для управления томами. Они используются для интеграции Docker с различными хранилищами, такими как сетевые файловые системы (NFS), облачные хранилища (AWS EBS, Google Persistent Disk) или специализированные системы хранения (Ceph, GlusterFS).

- Позволяют создавать, монтировать и удалять тома из внешних хранилищ.
- Можно добавлять сторонние плагины через Docker Volume API.
- Контейнеры получают доступ к данным на этих томах, как если бы это было локально
### Типы монтирования

В Docker в данный момент есть 4 типа монтирований:
- первый тип - монтирование во время сборки , он берёт данные только из контекста сборки.
```Docker
RUN --mount=type=bind,source=key.json,destination=cloud-key.json \
    ls -al > ls.txt
```
`docker image build --secret id=my-cloud-key,src=key.json -f Dockerfile -t test .`
- второй тип - `bind mount`, когда файл или директория хоста монтируется внутрь контейнера.
- третий тип - `tmpfs` (для Windows есть своя техника `Named pipes`)
- четвертый - использовать объект `volume`
  
Volumes

- убрать зависимость размещения контейнера от одного docker-хоста.
- убрать отличия конфигураций разных docker-хостов.
- организовать удалённое хранение данных.
- единая точка управления данными: перенос данных, бэкап и т.д.
- расшарить данных между контейнерами.
- ускорение работы Docker Desktop на платформах, отличных от Linux.

Bind

- при разработке приложения, например работая по методике dev-container. Или для отладки приложения в определенной среде, когда код можно править на хосте, а запускать в контейнере.
- прокинуть конфигурационные файлы хоста в контейнер.
- расшарить директорию между контейнерами, в основном используется для передачи настроек приложения.
- для запуска systemd внутри контейнера.

TMP

- хранение чувствительной информации
- создание буфера для операций загрузки/выгрузки
- хранение временных файлов с высокой скоростью доступа