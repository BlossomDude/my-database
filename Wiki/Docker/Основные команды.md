---
Owner: Blossom Dude
Last edited time: 2024-07-11T15:15
Created time: 2023-06-30T11:29
---
  

# DOCKER

## A,B,C,D

- `docker build *path*` - создать образ. Нужно указать путь где хранится основа для образа.
    - `-f` - указать имя Dockerfile если он называется иначе.
    - `-t *container_name*` - присвоить имя образу
    - `--no-cache` - не кэшировать слои
    - `--target *stage_name*` - собрать только определенную стадию.
- `docker buildx build --output type=registry` - отправит образ в реджистри, если выберем тип ==image==, то просто соберет образ.
- `docker container prune` - удалить все остановленные контейнеры.
- `docker cp *source* *container*:*dest*` - cкопировать на контейнер или из контейнера
- `docker commit *container* *new_image*` - создать полноценный образ из бегущего контейнера.

## E,F,G,H

- `docker exec -it *``_container_id*_` `bash` _-_ запустить bash в контейнере
- `docker export foo > foo_fs.tar` - экспортировать контейнер в tar-архив

## I,J,K,L

- `docker inspect *obj_id*` - подробная информация об объекте в json-формате.
- `docker images` — Посмотреть все образы на своей машине
- `docker image`
    - `prune -a` - удаление всех неиспользуемых образов
    - `history *image*` - вывести список всех слоев образа
    - `save -o *name*.tar alpine:3.19` - упакует образ в tar-архив
    - `load -i name.tar` - загрузить образ из tar-архива
- `docker logs *container_id*` - показывает логи контейнера
- `docker login any-registry.ru` - подключиться к реестру образов докер.

## M,N,O,P

- `**docker network**` `create --driver bridge --subnet 182.18.0.0/16 my-custom-network` - Создаем пользовательскую сеть, тип сети bridge и указываем адрес сети с маской.
    - `ls` - посмотреть список сетей.
    - `inspect` - подробная информация о сети.
    - `connect *net_name* *container*` - подключить контейнер к сети
    - `disconnect *net_name* *container*` - отключить контейнер от сети
    - `-o *option*` - передать доп. опции
- `docker pull image` — Загрузить образ из DockerHub
- `docker ps` — Посмотреть все активные контейнеры
    - `-a` — Посмотреть все контейнеры

## Q,R,S,T

- `docker rmi -f *имя образа*` - принудительно(-f) удалить образ контейнера
- `docker top *con_name*` - вывести список процессов в контейнере.
- `docker run *image*` — Сформировать контейнер из образа
    - `-d` - фоновый режим.
    - `--cpus=.5 nginx` - разрешит контейнеру использовать не более 50% cpu.
    - `--memory=100m nginx` - ограничение ОЗУ 100Мб для контейнера.
    - `-e` - задать переменную среды
    - `--name *contairer_name*` - явно задать имя контейнера
    - `-p 8080:80`- публикация порта. (порт_пк:порт_контейнера)
    - `-v /host/path:/container/path` - добавление тома для сохранений изменений
    - `-it` - подключится сразу к контейнеру
    - `--rm` - автоматическое удаление после остановки
    - `--link container:container` - добавляет ссылку для связи между контейнерами. **Имя контейнера где живет сервис и(:) имя по которому будет обращаться с этим контейнером запускаемое приложение.** ==**Устаревшая конструкция, используй сети.**==
    - `--net=container:*any_container*` - подключит запускаемый контейнер к сети контейнера “any_container”
    - `--network=bridge` - присвоить контейнеру сеть
    - `--pid=container:*any_container*` - общие процессы с any_container. Например, ты можешь залезть в контейнер и исследовать его с помощью `strace`. И тебе не потребуется ставить дополнительное ПО в контейнер, останавливать контейнер и перезапускать приложение в нем.
    - `-restart no` - политика рестарта, если контенер остановится.
        - `no` - никогда не перезапускаются автоматичеки.
        - `on-failure` - перезапускает контейнер только в случае сбоя
        - `always` - контейнер будет перезапускаться всегда
        - `unless-stopped` - как `always`, но не перезапускает если остановлен в ручную
- `docker stop` - остановить контейнер
- `docker stats --no-stream` - вывести инфу по используемым ресурсам контейнерами
- `docker system events --since 60m` - список событий хоста в реальном времени (низкоуровнивые логи)
    - `--filer container=*name*`
    - `info` - выведет информацию о Dockerd
    - `df` - информация о занятом месте образами, контейнерами и тд.

## U,V,W,X,Y,Z

# DOCKERD

`dockerd` - запустить демон докер

`--host=1.1.1.1:2375` - по умолчанию десон докер доступен только внутри хоста, с помощью этого флага и айпи адреса мы можем открыть доступ извне.

> `2375` - порт докера по умолчанию не зашифрованный  
>   
> `2376` - порт докера зашифрованный

`--debug` - включить дебаг.

`--tls=true` - включить tls

`--tlscert=/var/docker/cer.cert` - указать сертификат

`--tlskey=/var/docker/key.pem` - указать ключ

# SWARM

`docker swarm init` - инициализация узла-менеджера Docker Swarm

`--advertise-addr 10.0.0.1:2377` -  указывает, какой адрес будет сообщён, когда ты затребуешь команду на присоединение. Это или IP-адрес менеджера или адрес внешнего балансировщика, которые пересылает трафик на менеджер. Если не установлен, то попробует получить его из `**listen-addr**`

`--listen-addr 10.0.0.1:2377` - это IP-адрес, на котором этот менеджер будет ожидать обращений других менеджеров в процессе управления кластером, а также получать запросы на присоединение. По умолчанию слушает на всех интерфейсах на порту `**2377**`.

`--autolock=true` - В результате работы команда возвращает ключ, который можно использовать для разблокировки менеджера после его перезапуска

`docker swarm join --token *token* *ip_manager*` - присоеденить узел к кластеру

`docker node ls` - список нод в кластере

`docker node promote worker-0` - повысить воркер до менеджера

`docker node demote manager-0` - понизить менеджера до воркера

`docker node update --availability drain worker-0` - Это защитит узел от новых нагрузок и переместит контейнеры с нагрузкой с `**worker-0**` на `**worker-1**`

`docker node update --availability active worker-0` - сделать узел снова доступным

`docker swarm leave` - удалит воркер из кластера, но нужно чтобы статус был ==drain==

`**docker node rm worker-1**` **- после этого полностью удалит ноду**